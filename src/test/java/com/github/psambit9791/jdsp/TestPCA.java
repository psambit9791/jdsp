/*
 * Copyright (c) 2020 Sambit Paul
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

package com.github.psambit9791.jdsp;

import com.github.psambit9791.jdsp.misc.Plotting;
import com.github.psambit9791.jdsp.misc.UtilMethods;
import com.github.psambit9791.jdsp.transform.PCA;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Order;
import org.junit.jupiter.api.Test;

import java.io.File;
import java.io.IOException;

public class TestPCA {

    final double[][] signal = {{0.38, 0.53}, {0.80, 0.86}, {0.11, 0.88}, {0.72, 0.87}, {0.37, 0.52}};

    final double[][] raw_signal = {{0.0003459, 1.16e-05, -0.0001411}, {0.0002737, 3.53e-05, -0.0001609}, {0.0002353, 5.42e-05, -0.000178}, {0.0001709, 6.83e-05, -0.0001888}, {0.0001016, 4.63e-05, -0.0002109}, {-1.1e-06, 5.28e-05, -0.0001792}, {-3.14e-05, 2.93e-05, -0.0001652}, {-0.0001092, 3.4e-06, -0.0001286}, {-0.0001199, -4.4e-05, -0.000126}, {-0.0001731, -7.91e-05, -0.0001021}, {-0.0001803, -0.0001218, -8.7e-05}, {-0.0001926, -0.0001171, -4.47e-05}, {-0.0001615, -0.0001349, -5.35e-05}, {-0.0001516, -0.0001127, -2.98e-05}, {-8.04e-05, -8.19e-05, 5.3e-06}, {-6.4e-05, -3.23e-05, 7.43e-05}, {-1.9e-05, 1.75e-05, 0.0001245}, {-5e-06, 9.12e-05, 0.0001708}, {2.15e-05, 0.0001236, 0.00018}, {5.18e-05, 0.0001611, 0.000199}, {8.33e-05, 0.0001562, 0.0002006}, {0.0001024, 0.0001403, 0.000172}, {0.0001401, 8.94e-05, 0.0001198}, {0.000168, 8.6e-06, 5.61e-05}, {0.0001632, -8.73e-05, 1.14e-05}, {0.0001635, -0.0001681, -1.96e-05}, {0.0001187, -0.0002478, -3.3e-05}, {8.91e-05, -0.0003049, -4.9e-05}, {2.69e-05, -0.0003411, -2.12e-05}, {-4.13e-05, -0.0003411, -9.8e-06}, {-0.0001245, -0.0002986, 2.19e-05}, {-0.0001364, -0.0002562, 7.2e-06}, {-0.0001856, -0.0001728, -1.24e-05}, {-0.0001898, -0.0002064, -5.34e-05}, {-0.0002142, -0.0001816, -8.34e-05}, {-0.00021, -0.0001891, -0.0001557}, {-0.0001984, -0.0002179, -0.0002128}, {-0.000151, -0.000253, -0.0002763}, {-0.0001347, -0.0002896, -0.0002948}, {-8.48e-05, -0.0003957, -0.0003048}, {-4.88e-05, -0.0002763, -0.0003034}, {-1.74e-05, -0.0002565, -0.000292}, {2.64e-05, -0.0002166, -0.0002656}, {3.91e-05, -0.000159, -0.0002058}, {5.46e-05, -0.0001376, -0.0001434}, {4.41e-05, -0.000106, -9.07e-05}, {5.07e-05, -3.6e-05, -3.93e-05}, {4e-05, -5.83e-05, 2.09e-05}, {5.52e-05, -5.81e-05, 4.01e-05}, {4.19e-05, -5.32e-05, 5.44e-05}, {8.08e-05, -4.95e-05, 3.13e-05}, {6.23e-05, -7.3e-06, -7e-07}, {9.08e-05, 3.7e-06, -4.66e-05}, {8.09e-05, 2.1e-05, -9.01e-05}, {0.0001033, 2.84e-05, -0.0001474}, {7.59e-05, 5.43e-05, -0.0001811}, {5.72e-05, 6.67e-05, -0.0002262}, {2.4e-06, 6.16e-05, -0.0002762}, {3.8e-06, 3.4e-05, -0.0003235}, {-4.18e-05, 4.01e-05, -0.0003384}, {-7.5e-05, 7.7e-06, -0.0003507}, {-0.0001391, -3.72e-05, -0.0003366}, {-0.0001558, -8.97e-05, -0.0003076}, {-0.0001377, -0.0001473, -0.0002447}, {-0.0001084, -0.0001875, -0.0001494}, {-8.91e-05, -0.0002275, -3.55e-05}, {-3.65e-05, -0.0002824, 2.96e-05}, {3.73e-05, -0.0002924, 6.47e-05}, {0.0001235, -0.0002774, 7.98e-05}, {0.0002132, -0.0002472, 9.37e-05}, {0.0002434, -0.0001958, 0.0001012}, {0.0003047, -0.0001629, 7.49e-05}, {0.000336, -0.0001166, 2.12e-05}, {0.00038, -6.05e-05, -1e-06}, {0.0003816, -2.44e-05, 2.41e-05}, {0.000387, -6e-06, 3.18e-05}, {0.0003402, 2.09e-05, 1.35e-05}, {0.0003307, 3.27e-05, -2.86e-05}, {0.0002563, 7.09e-05, -4.43e-05}, {0.000222, 9.04e-05, -4.61e-05}, {0.0001478, 8.9e-05, -4.81e-05}, {0.0001122, 8.39e-05, -8.26e-05}, {7.15e-05, 6.28e-05, -9.61e-05}, {8.45e-05, 1.08e-05, -7.24e-05}, {9.6e-05, -8.6e-06, -4.51e-05}, {0.0001351, -2.58e-05, -4.02e-05}, {0.0001591, -1.44e-05, -5.42e-05}, {0.0001792, 1.95e-05, -6.08e-05}, {0.0002057, 4.83e-05, -7.46e-05}, {0.0002234, 0.0001217, -9.22e-05}, {0.0002174, 0.0001976, -0.0001505}, {0.000173, 0.0002321, -0.0001728}, {0.0001535, 0.0002219, -0.0001899}, {9.67e-05, 0.0001982, -0.000182}, {9.97e-05, 0.0001806, -0.0002062}, {3.9e-05, 0.0001767, -0.0001822}, {-6.8e-06, 0.0001269, -0.0001705}, {-5.02e-05, 0.0001159, -0.0001428}, {-4.52e-05, 0.0001151, -0.0001536}, {-7.38e-05, 0.0001516, -0.0001458}, {-4.39e-05, 0.0001679, -0.0001481}, {-7.11e-05, 0.0001617, -0.000128}, {-4.96e-05, 0.000157, -0.0001415}, {-4.29e-05, 0.0001834, -0.0001225}, {-4.14e-05, 0.0001733, -9.62e-05}, {-5.21e-05, 0.0001633, -6.84e-05}, {-6.54e-05, 0.000147, -5.68e-05}, {-0.0001035, 0.0001545, -4.9e-05}, {-0.0001493, 0.0001721, -2.88e-05}, {-0.0001828, 0.0001857, -3.72e-05}, {-0.0002064, 0.0001918, -7.19e-05}, {-0.0001987, 0.0002043, -0.0001327}, {-0.0002113, 0.0002328, -0.0001776}, {-0.0001875, 0.0002514, -0.00022}, {-0.00019, 0.0002946, -0.0002311}, {-0.0001225, 0.000333, -0.0002743}, {-7.98e-05, 0.0003527, -0.0002692}, {-1.45e-05, 0.0003564, -0.0002502}, {-4e-06, 0.000375, -0.0001837}, {4.53e-05, 0.0003674, -0.0001294}, {7.09e-05, 0.0003688, -5.78e-05}, {0.0001251, 0.0003006, -3.61e-05}, {0.0001144, 0.0002349, -2.3e-06}, {9.98e-05, 0.0002078, 3.06e-05}, {5.67e-05, 0.0001881, 2.98e-05}, {5.58e-05, 0.0001349, -8.6e-06}, {2.88e-05, 9.77e-05, -2.96e-05}, {-1.97e-05, 5.52e-05, -6.43e-05}, {-4.57e-05, 6.01e-05, -6.67e-05}, {-6.54e-05, 7.5e-05, -4.04e-05}, {-4.52e-05, 4.99e-05, -5.41e-05}, {-3.39e-05, 2.97e-05, -1.18e-05}, {-3.62e-05, 2.43e-05, 4.66e-05}, {-4.73e-05, 2.9e-05, 8.86e-05}, {-5.8e-06, 4.27e-05, 0.0001082}, {-1.28e-05, 6.76e-05, 0.0001219}, {2.12e-05, 7.98e-05, 9.45e-05}, {5e-07, 0.0001008, 8.45e-05}, {1.08e-05, 0.000123, 3.23e-05}, {2.48e-05, 0.0001679, -3.6e-06}, {2.88e-05, 0.0001967, -2.08e-05}, {1.4e-06, 0.0002154, -1.65e-05}, {-1.61e-05, 0.0002142, -2.48e-05}, {-6.57e-05, 0.0002107, -7.3e-06}, {-8.66e-05, 0.000226, 2.66e-05}, {-0.0001088, 0.0002276, 7.05e-05}, {-0.0001533, 0.0002005, 7.68e-05}, {-0.0001306, 0.0001645, 4.7e-05}, {-0.0001, 0.0001284, 1.58e-05}, {-2.22e-05, 5.61e-05, -1.42e-05}, {5.18e-05, -0.0, -5.28e-05}, {0.0001305, -7.86e-05, -0.0001123}, {0.0001731, -0.0001335, -0.0001595}, {0.0002644, -0.0001699, -0.0001989}, {0.0002798, -0.0001876, -0.0002107}, {0.0002963, -0.0002127, -0.0002127}, {0.0002666, -0.0001881, -0.0001899}, {0.0002469, -0.0001834, -0.0001582}, {0.0002038, -0.0001538, -9.58e-05}, {0.000197, -0.0001452, -6.33e-05}, {0.0001438, -0.0001416, -2.35e-05}, {0.000118, -0.0001477, 1.48e-05}, {8.49e-05, -0.0001326, 3.73e-05}, {5.68e-05, -0.0001226, 6e-05}, {4.88e-05, -8.78e-05, 6.51e-05}, {4.44e-05, -4.9e-05, 3.55e-05}, {3.35e-05, -1.17e-05, 2.71e-05}, {4.38e-05, 2.83e-05, 3.12e-05}, {6.78e-05, 7.32e-05, 3.79e-05}, {6.82e-05, 0.000112, 6.57e-05}, {8.07e-05, 0.0001297, 4.83e-05}, {3.96e-05, 0.0001225, 4.73e-05}, {4.22e-05, 7.41e-05, 4.51e-05}, {-1.61e-05, 4.45e-05, 6.77e-05}, {-7.29e-05, -1.65e-05, 7.04e-05}, {-0.0001509, -6.63e-05, 5.29e-05}, {-0.0001792, -0.0001239, 5.5e-06}, {-0.0002297, -0.0001553, -1.43e-05}, {-0.0002128, -0.0001868, -6.16e-05}, {-0.0002496, -0.0001872, -7.67e-05}, {-0.0001993, -0.0001854, -0.0001079}, {-0.0001541, -0.0001272, -0.0001067}, {-0.0001028, -8.4e-05, -6.41e-05}, {-7.75e-05, -2.56e-05, -2.41e-05}, {-3.13e-05, 2.3e-05, 1.35e-05}, {-1.5e-05, 9.27e-05, 7.74e-05}, {4.12e-05, 0.0001588, 0.0001041}, {7.99e-05, 0.0002003, 8.23e-05}, {9.37e-05, 0.0002066, 1.92e-05}, {0.0001301, 0.0002214, -0.000105}, {0.000159, 0.0002239, -0.0001818}, {0.0002055, 0.0002186, -0.0002512}, {0.0002221, 0.0001983, -0.0003083}, {0.0002173, 0.0001657, -0.0003244}, {0.0001603, 0.0001579, -0.0002946}, {0.0001631, 0.0001665, -0.0002546}, {0.0001283, 0.0001728, -0.0001648}, {0.0001196, 0.0001654, -0.0001038}, {6.61e-05, 0.000167, -2.03e-05}, {5.23e-05, 0.0001687, 1.6e-05}, {3e-05, 0.000199, 2.23e-05}, {6.13e-05, 0.0002221, 3.4e-05}, {6.02e-05, 0.0002327, 3.42e-05}, {9.18e-05, 0.0002057, 1.09e-05}, {9.11e-05, 0.000211, -1.36e-05}, {0.0001165, 0.00022, -8.78e-05}, {0.0001207, 0.0002214, -0.0001385}, {0.0001312, 0.000184, -0.0001642}, {0.0001167, 0.0001265, -0.0002101}, {8.6e-05, 4.14e-05, -0.0002284}, {3.38e-05, 2.4e-06, -0.000237}, {3e-07, -8.01e-05, -0.000248}, {-4.43e-05, -0.0001838, -0.0002327}, {-8.13e-05, -0.0002763, -0.0001939}, {-0.0001071, -0.0003475, -0.0001925}, {-0.0001115, -0.00038, -0.000186}, {-0.0001134, -0.0003463, -0.0001845}, {-9.9e-05, -0.0003375, -0.000188}, {-7.58e-05, -0.000279, -0.0001829}, {-5.5e-06, -0.0001894, -0.0001719}, {5.24e-05, -7.49e-05, -0.0001843}, {0.00012, 4.47e-05, -0.0001729}, {0.0001489, 0.0001206, -0.0001392}, {0.0001978, 0.000123, -0.0001041}, {0.0002416, 0.0001564, -5.04e-05}, {0.0002779, 0.0001462, -1.53e-05}, {0.0002245, 9.01e-05, 2.6e-06}, {0.0001973, -8.5e-06, 2.92e-05}, {0.0001403, -0.0001234, 7.67e-05}, {0.0001069, -0.0002047, 9.33e-05}, {6.21e-05, -0.0002336, 0.0001184}, {1.12e-05, -0.0002886, 0.0001037}, {-5.46e-05, -0.0003272, 8.04e-05}, {-5.06e-05, -0.0003347, 6.7e-05}, {-4.66e-05, -0.0003345, 5.23e-05}, {-4.77e-05, -0.0003131, -1.2e-06}, {-3.14e-05, -0.0003066, -5.71e-05}, {-1.99e-05, -0.0003062, -0.000143}, {2.7e-06, -0.0002972, -0.0002177}, {1.28e-05, -0.0002622, -0.0002753}, {-3.4e-06, -0.0002283, -0.0003353}, {-4.94e-05, -0.0001636, -0.0003889}, {-6.67e-05, -0.0001114, -0.0004424}, {-0.0001225, -4.92e-05, -0.0004473}, {-0.0001511, 1.68e-05, -0.000422}, {-0.0002118, 8.88e-05, -0.0003593}, {-0.0002139, 0.0001284, -0.0002752}, {-0.000211, 0.000173, -0.0001899}, {-0.0001819, 0.0001967, -0.0001495}, {-0.0001415, 0.0002291, -8.42e-05}, {-5.63e-05, 0.0002501, -7.75e-05}, {9.1e-06, 0.0002389, -8.97e-05}, {0.0001029, 0.0002242, -0.0001317}, {0.0001718, 0.0002319, -0.0001813}, {0.0002344, 0.0002333, -0.0002072}, {0.0002882, 0.0002249, -0.0001734}, {0.0002858, 0.0002176, -0.0001395}, {0.0002437, 0.0002204, -8.56e-05}, {0.0001742, 0.0002504, -4.2e-06}, {0.0001211, 0.0002602, 8.83e-05}, {3.06e-05, 0.0002475, 0.0001681}, {-1.11e-05, 0.0002261, 0.0001893}, {-7.78e-05, 0.0002218, 0.0001981}, {-9.46e-05, 0.0001891, 0.0001981}, {-0.000114, 0.0001401, 0.0002191}, {-6.37e-05, 8.26e-05, 0.000194}, {-6.22e-05, 6.76e-05, 0.0001728}, {-1.35e-05, 7.15e-05, 0.0001406}, {-3.34e-05, 7.19e-05, 0.0001642}, {6.5e-06, 6.25e-05, 0.0001655}, {3.67e-05, 7.17e-05, 0.0001755}, {0.0001143, 9.84e-05, 0.0001408}, {0.0001232, 0.0001425, 0.000121}, {0.0001885, 0.0001475, 8.24e-05}, {0.0002278, 0.0001539, 8.37e-05}, {0.0002893, 0.0001949, 6.77e-05}, {0.0003111, 0.0002371, 7.06e-05}, {0.0003089, 0.0003003, 5.35e-05}, {0.0002756, 0.0003522, 9.49e-05}, {0.0002798, 0.0002285, 0.0001475}, {0.0002264, 0.0001587, 0.000209}, {0.000178, 4.39e-05, 0.0002318}, {0.0001258, -0.0001208, 0.0002545}, {6.25e-05, -0.0002906, 0.0002533}, {2.79e-05, -0.0004939, 0.0002596}, {-5e-07, -0.0006945, 0.0002135}, {-4.88e-05, -0.0005849, 0.0001776}, {-4.46e-05, -0.000559, 0.0001304}, {-4.16e-05, -0.0005019, 8.57e-05}, {-2.11e-05, -0.0004158, 3.25e-05}, {1.68e-05, -0.0003158, 5.6e-06}, {5.59e-05, -0.0002021, -2.28e-05}, {9.01e-05, -9.97e-05, -2.63e-05}, {0.0001241, -0.0001568, -5.36e-05}, {0.0001356, -0.0001864, -6.46e-05}, {0.0001321, -0.0002038, -6.06e-05}, {0.000121, -0.000204, -5.54e-05}, {0.0001099, -0.000213, -2.54e-05}, {7.88e-05, -0.0002196, 1.97e-05}, {3.13e-05, -0.0002, 5.99e-05}, {-7.3e-06, -0.0001692, 0.0001187}, {-5.97e-05, -0.0001147, 0.000196}, {-5.59e-05, -5.13e-05, 0.000267}, {-5.45e-05, -1.64e-05, 0.0003446}, {-5.68e-05, 3.34e-05, 0.0003462}, {-4.04e-05, 9.44e-05, 0.0003254}, {1.99e-05, 0.0001219, 0.0003034}, {9.02e-05, 0.0001507, 0.0002752}, {0.0001757, 0.0001656, 0.0002146}, {0.0001803, 0.0001578, 0.0001428}, {0.000221, 0.0001452, 6.83e-05}, {0.0002256, 0.00012, 5.85e-05}, {0.0002314, 4.27e-05, 7.12e-05}, {0.0001861, 6.3e-06, 0.0001075}, {0.0001331, -2.86e-05, 0.0001177}, {8.87e-05, -4.08e-05, 0.0001206}, {0.0001027, -4.29e-05, 0.000152}, {6.06e-05, -1.76e-05, 0.0001795}, {6.83e-05, -6e-06, 0.0001597}, {4.98e-05, 4.66e-05, 0.0001089}, {7.24e-05, 6.3e-05, 1.69e-05}, {6.39e-05, 6.54e-05, -1.29e-05}, {6.04e-05, 3.27e-05, -3.41e-05}, {1.83e-05, -7.5e-06, -6.15e-05}, {7.4e-06, -8e-05, -9.74e-05}, {-1.99e-05, -0.0001324, -9.35e-05}, {-1e-05, -0.0001773, -6.86e-05}, {-2.49e-05, -0.000212, -2.12e-05}, {6e-06, -0.0002392, -1.86e-05}, {-1.04e-05, -0.0002312, 2.41e-05}, {3.42e-05, -0.0002372, 4.67e-05}, {4.15e-05, -0.0002158, 9.67e-05}, {6.38e-05, -0.0001946, 0.0001306}, {3.66e-05, -0.0001533, 0.0001894}, {3.18e-05, -0.0001011, 0.0002657}, {3.09e-05, -4.64e-05, 0.0003382}, {5.51e-05, -2.18e-05, 0.000377}, {2.71e-05, 2.05e-05, 0.0004157}, {2.51e-05, 6.51e-05, 0.0004459}, {3.69e-05, 8e-05, 0.0004525}, {6.6e-05, 4.74e-05, 0.0004117}, {7.53e-05, 1.86e-05, 0.0003296}, {5.34e-05, -9e-06, 0.0002688}, {5e-05, -1.8e-05, 0.0001868}, {6.16e-05, 6.7e-06, 0.0001372}, {3.94e-05, 6.48e-05, 7.25e-05}, {1e-05, 4.22e-05, 9.5e-05}, {-6.54e-05, 4.95e-05, 0.0001686}, {-0.0001298, 2.95e-05, 0.0002797}, {-0.0002676, 2.95e-05, 0.000398}, {-0.0004179, -3.89e-05, 0.0005774}, {-0.0006129, -0.0001771, 0.0007717}, {-0.0007618, -0.0004296, 0.001047}, {-0.0009968, -0.0004655, 0.0012552}, {-0.0011409, -0.0005449, 0.0014495}, {-0.0013298, -0.0005933, 0.0016825}, {-0.0013903, -0.0006914, 0.0019381}, {-0.0014795, -0.0006825, 0.0021774}, {-0.0015266, -0.0006511, 0.0023919}, {-0.0015736, -0.0005166, 0.0025217}, {-0.0015508, -0.0004878, 0.0026489}, {-0.0015431, -0.0004405, 0.0027511}, {-0.0014981, -0.0003844, 0.0027636}, {-0.0014807, -0.0003073, 0.0027101}, {-0.0014405, -0.0002626, 0.002613}, {-0.0013843, -0.0001891, 0.0024973}, {-0.0013468, -0.0001604, 0.0023642}, {-0.0013006, -0.0001428, 0.0022338}, {-0.0012915, -7.94e-05, 0.0021097}, {-0.0012687, -5.96e-05, 0.0020144}, {-0.0012794, -2.96e-05, 0.0019391}, {-0.0012716, -7.2e-06, 0.0018826}, {-0.0012823, -7.4e-06, 0.0018173}, {-0.0012866, 4.8e-06, 0.0017718}, {-0.0012873, 1.44e-05, 0.00172}, {-0.0012621, -4.4e-06, 0.0016594}, {-0.0012295, -3.81e-05, 0.0015949}, {-0.0011808, -4.58e-05, 0.001529}, {-0.0011185, -5.59e-05, 0.001443}, {-0.0010202, -4.08e-05, 0.0013184}, {-0.0008784, -1.57e-05, 0.0012}, {-0.0007428, 2.06e-05, 0.0010718}, {-0.0005745, 6.31e-05, 0.0009324}, {-0.0004212, 0.000189, 0.0007718}, {-0.0002255, 0.0002677, 0.0006002}, {-5.72e-05, 0.0003475, 0.0004225}, {7.15e-05, 0.0004159, 0.0002923}, {0.0001679, 0.0004532, 0.0001308}, {0.0002556, 0.0004871, -1.96e-05}, {0.0002883, 0.0004921, -0.0001612}, {0.0003076, 0.0004536, -0.0002828}, {0.000281, 0.000416, -0.0004083}, {0.0002495, 0.0003735, -0.0005128}, {0.000229, 0.0003313, -0.0005938}, {0.0001861, 0.0003212, -0.0006387}, {0.0001456, 0.0003047, -0.0006424}, {0.0001224, 0.0003033, -0.0006461}, {0.0001277, 0.000292, -0.000621}, {0.0001502, 0.0003122, -0.000581}, {0.0001801, 0.0003224, -0.0005271}, {0.000189, 0.0002977, -0.0004969}, {0.0002079, 0.0002493, -0.0004718}, {0.0002168, 0.0002124, -0.0005228}, {0.0002296, 0.0001554, -0.0005501}, {0.0002101, 0.0001058, -0.0005713}, {0.0001782, 3.23e-05, -0.0005775}, {0.0001299, -2.12e-05, -0.0005726}, {0.0001388, -6.36e-05, -0.0005811}, {0.0001365, -9e-05, -0.0005607}, {0.0001593, -0.0001502, -0.0004979}, {0.0001682, -0.0001816, -0.0004462}, {0.0002032, -0.0002168, -0.0004395}, {0.000227, -0.0002494, -0.0004305}, {0.0002685, -0.0002896, -0.0004513}, {0.0002627, -0.0002984, -0.0004387}, {0.0002694, -0.0003182, -0.0004711}, {0.0002783, -0.0002942, -0.0005074}, {0.0002998, -0.0002652, -0.0005264}, {0.0003326, -0.0002438, -0.000549}, {0.0003543, -0.0002173, -0.0005788}, {0.0003783, -0.0001995, -0.0006011}, {0.0004038, -0.0001732, -0.0006358}, {0.0004192, -0.0001308, -0.0006431}, {0.0004085, -0.000111, -0.000649}, {0.0003666, -0.0001012, -0.0006847}, {0.000281, -7.27e-05, -0.0006731}, {0.0002201, -2.92e-05, -0.0006766}, {0.0001567, 2.55e-05, -0.0006766}, {9.07e-05, 4.89e-05, -0.0006766}, {5.96e-05, 6.97e-05, -0.0006776}, {2.63e-05, 0.0001093, -0.0006537}, {2.15e-05, 0.0001589, -0.0006125}, {4.79e-05, 0.000197, -0.0006088}, {5.95e-05, 0.0002303, -0.0005578}, {7.86e-05, 0.0002611, -0.0005002}, {0.0001164, 0.0002994, -0.0004475}, {0.0001319, 0.0003255, -0.0004286}, {0.0001708, 0.0003343, -0.0004457}, {0.0002184, 0.000323, -0.0004753}, {0.0002339, 0.0003132, -0.0004935}, {0.0002693, 0.0002822, -0.0005665}, {0.0002923, 0.0002499, -0.0006359}, {0.000294, 0.0002252, -0.0006967}, {0.000297, 0.0001917, -0.0007228}, {0.0002651, 0.0001644, -0.0007291}, {0.0002268, 0.0001558, -0.0007216}, {0.0002045, 0.0001399, -0.0006816}, {0.0001932, 0.0001352, -0.0006465}, {0.0001943, 0.0001417, -0.0006216}, {0.0002291, 0.0001355, -0.0005965}, {0.0002615, 0.0001529, -0.0005624}, {0.00032, 0.0001702, -0.0005183}, {0.0003574, 0.0001824, -0.0004756}, {0.0004176, 0.0002018, -0.000483}, {0.0004605, 0.0002148, -0.0004456}, {0.0004647, 0.0002105, -0.0003956}, {0.0004626, 0.0002026, -0.0003534}, {0.0004444, 0.000175, -0.000335}, {0.0004263, 0.000155, -0.0003352}, {0.0004319, 0.0001201, -0.0003428}, {0.0004076, 0.0001005, -0.0003354}, {0.0003818, 8.72e-05, -0.0003379}, {0.0003886, 8.37e-05, -0.0003701}, {0.0003594, 7.41e-05, -0.0004107}, {0.000355, 8.04e-05, -0.0004262}, {0.0003567, 6.3e-05, -0.0004344}, {0.000346, 5.96e-05, -0.0004127}, {0.0003688, 4.34e-05, -0.0003772}, {0.0003804, 3.97e-05, -0.0003678}, {0.0004117, 5e-06, -0.0003274}, {0.0004506, -3.6e-06, -0.0002686}, {0.0004917, -1.7e-05, -0.0002574}, {0.0005304, -1.95e-05, -0.0002772}, {0.0005689, -4.83e-05, -0.0003456}, {0.000569, -0.0001071, -0.0004227}, {0.0005728, -0.0001808, -0.00048}, {0.0005503, -0.0002271, -0.0005711}, {0.000518, -0.0002747, -0.0006658}, {0.0004685, -0.0003235, -0.0007392}, {0.0003778, -0.0003633, -0.0007878}, {0.0002997, -0.000377, -0.0008325}, {0.0002354, -0.0003382, -0.0008674}, {0.0001724, -0.0002896, -0.0009096}, {0.0001085, -0.000235, -0.000927}, {7.53e-05, -0.0001966, -0.0009565}, {5.32e-05, -0.0001683, -0.0009537}, {6.72e-05, -0.0001389, -0.0009271}, {8.24e-05, -0.000102, -0.0008708}};

    @Test
    @Order(1)
    public void createTestOutputDirectory() {
        String dirName = "./test_outputs/";
        File directory = new File(dirName);
        if (! directory.exists()){
            directory.mkdir();
        }
    }

    @Test
    public void PCATest1() {
        final double[] explained_variance = {0.0848, 0.0307};
        final double[] explained_variance_ratio = {0.7339, 0.2661};
        final double[] singular_values = {0.5823, 0.3506};
        double[][] result = {{-0.1531, -0.163 }, { 0.3476,  0.023 }, {-0.3033,  0.2527}, { 0.2745,  0.0569}, {-0.1657, -0.1695}};

        PCA p1 = new PCA(this.signal, 2);
        p1.fit();

        Assertions.assertArrayEquals(explained_variance, p1.explained_variance_, 0.0001);
        Assertions.assertArrayEquals(explained_variance_ratio, p1.explained_variance_ratio_, 0.0001);
        Assertions.assertArrayEquals(singular_values, p1.singular_values_, 0.0001);

        double[][][] usv = p1.getUSV();

        final double[][] U = {{-0.2629, -0.465 }, { 0.597 ,  0.0655}, {-0.5209,  0.7207}, { 0.4714,  0.1623}, {-0.2845, -0.4835}};
        final double[][] S = {{0.5823, 0}, {0, 0.3506}};
        final double[][] V = {{ 0.9522,  0.3053}, {-0.3053,  0.9522}};

        for (int i=0; i<U.length; i++) {
            Assertions.assertArrayEquals(U[i], usv[0][i], 0.001);
        }
        for (int i=0; i<S.length; i++) {
            Assertions.assertArrayEquals(S[i], usv[1][i], 0.001);
        }
        for (int i=0; i<V.length; i++) {
            Assertions.assertArrayEquals(V[i], usv[2][i], 0.001);
        }

        double[][] newSignal = p1.transform();
        for (int i=0; i<result.length; i++) {
            Assertions.assertArrayEquals(result[i], newSignal[i], 0.001);
        }
    }

    @Test
    public void PCATest2() {
        final double[] explained_variance = {0.0848};
        final double[] explained_variance_ratio = {0.7339};
        final double[] singular_values = {0.5823};
        double[][] result1 = {{-0.1531}, { 0.3476}, {-0.3033}, { 0.2745}, {-0.1657}};
        double[][] result2 = {{-0.4617}, {-0.4375}, { 0.0507}, { 0.2745}, {-0.1315}};

        PCA p1 = new PCA(this.signal, 1);
        p1.fit();

        Assertions.assertArrayEquals(explained_variance, p1.explained_variance_, 0.0001);
        Assertions.assertArrayEquals(explained_variance_ratio, p1.explained_variance_ratio_, 0.0001);
        Assertions.assertArrayEquals(singular_values, p1.singular_values_, 0.0001);

        double[][] newSignal = p1.transform();
        for (int i=0; i<result1.length; i++) {
            Assertions.assertArrayEquals(result1[i], newSignal[i], 0.001);
        }

        double[][] signal2 = {{0.12, 0.33}, {0.20, 0.16}, {0.61, 0.48}, {0.72, 0.87}, {0.47, 0.32}};
        double[][] newSignal2 = p1.transform(signal2);
        for (int i=0; i<result2.length; i++) {
            Assertions.assertArrayEquals(result2[i], newSignal2[i], 0.001);
        }
    }

    @Test
    public void PCATest3() throws IOException {
        double[][] reduced_signal = {{-0.0002986}, {-0.0002809}, {-0.0002778}, {-0.0002554}, {-0.0002366}, {-0.0001576}, {-0.0001278}, {-5.42e-05}, {-4.17e-05}, {9.4e-06}, {3.03e-05}, {7.22e-05}, {5.06e-05}, {6.35e-05}, {5.39e-05}, {9.94e-05}, {0.0001142}, {0.0001391}, {0.0001301}, {0.0001271}, {0.0001128}, {8.02e-05}, {2.15e-05}, {-3.9e-05}, {-6.5e-05}, {-8.35e-05}, {-6.4e-05}, {-5.68e-05}, {2.4e-06}, {4.71e-05}, {0.0001124}, {0.0001017}, {0.0001018}, {7.23e-05}, {5.67e-05}, {-6.3e-06}, {-5.81e-05}, {-0.000133}, {-0.0001535}, {-0.0001769}, {-0.0002061}, {-0.0002144}, {-0.0002183}, {-0.0001796}, {-0.0001365}, {-8.93e-05}, {-5.59e-05}, {3.2e-06}, {1.18e-05}, {3.03e-05}, {-9.7e-06}, {-3.18e-05}, {-8.66e-05}, {-0.0001204}, {-0.0001815}, {-0.0001988}, {-0.000229}, {-0.0002431}, {-0.0002814}, {-0.0002713}, {-0.0002616}, {-0.0002122}, {-0.0001737}, {-0.0001235}, {-5.31e-05}, {3.82e-05}, {7.23e-05}, {6.55e-05}, {3.27e-05}, {-4.3e-06}, {-1.86e-05}, {-7.57e-05}, {-0.0001422}, {-0.0001893}, {-0.0001723}, {-0.0001704}, {-0.0001647}, {-0.000197}, {-0.0001761}, {-0.000162}, {-0.0001256}, {-0.0001363}, {-0.0001249}, {-0.0001061}, {-8.68e-05}, {-0.0001009}, {-0.0001262}, {-0.0001456}, {-0.0001738}, {-0.0002052}, {-0.0002595}, {-0.0002593}, {-0.0002629}, {-0.0002247}, {-0.0002451}, {-0.0001932}, {-0.0001547}, {-0.0001078}, {-0.0001195}, {-0.0001018}, {-0.0001208}, {-8.91e-05}, {-0.0001111}, {-0.000101}, {-7.83e-05}, {-4.81e-05}, {-2.98e-05}, {-4.3e-06}, {3.46e-05}, {4.32e-05}, {2.5e-05}, {-3.2e-05}, {-6.68e-05}, {-0.000117}, {-0.0001295}, {-0.0002048}, {-0.0002243}, {-0.0002419}, {-0.0001924}, {-0.0001705}, {-0.0001227}, {-0.000125}, {-8.41e-05}, {-4.59e-05}, {-2.25e-05}, {-4.95e-05}, {-4.98e-05}, {-5.03e-05}, {-3.96e-05}, {-8.5e-06}, {-2.8e-05}, {4.3e-06}, {5.58e-05}, {9.69e-05}, {9.1e-05}, {0.0001038}, {6.18e-05}, {6.17e-05}, {9.7e-06}, {-3.26e-05}, {-5.23e-05}, {-3.64e-05}, {-3.44e-05}, {6.2e-06}, {4.43e-05}, {9.3e-05}, {0.0001238}, {9.04e-05}, {5.18e-05}, {-6.4e-06}, {-7.16e-05}, {-0.0001547}, {-0.0002113}, {-0.000288}, {-0.0003041}, {-0.0003118}, {-0.0002796}, {-0.0002429}, {-0.0001706}, {-0.0001403}, {-7.94e-05}, {-3.29e-05}, {1.7e-06}, {3.44e-05}, {3.94e-05}, {1.25e-05}, {7.2e-06}, {1.4e-06}, {-9.7e-06}, {9.9e-06}, {-1.31e-05}, {7.8e-06}, {9.4e-06}, {6.15e-05}, {9.9e-05}, {0.000129}, {0.0001089}, {0.000121}, {7.51e-05}, {8.11e-05}, {2.86e-05}, {6e-07}, {6.4e-06}, {2.17e-05}, {2.52e-05}, {6.44e-05}, {5.18e-05}, {9.2e-06}, {-5.23e-05}, {-0.0001784}, {-0.000259}, {-0.0003415}, {-0.0003966}, {-0.0004046}, {-0.0003493}, {-0.0003174}, {-0.0002236}, {-0.0001664}, {-6.79e-05}, {-3.01e-05}, {-1.63e-05}, {-2.47e-05}, {-2.5e-05}, {-5.84e-05}, {-7.94e-05}, {-0.0001566}, {-0.0002022}, {-0.0002257}, {-0.0002517}, {-0.000243}, {-0.0002197}, {-0.0002037}, {-0.0001574}, {-9.6e-05}, {-7.45e-05}, {-6.34e-05}, {-6.46e-05}, {-7.58e-05}, {-8.92e-05}, {-0.0001248}, {-0.0001765}, {-0.0002134}, {-0.0002071}, {-0.0002024}, {-0.0001824}, {-0.00017}, {-0.0001217}, {-7.52e-05}, {6e-06}, {4.55e-05}, {9.27e-05}, {0.0001117}, {0.0001294}, {0.0001167}, {0.0001021}, {5.49e-05}, {-1.8e-06}, {-8.1e-05}, {-0.0001573}, {-0.0002151}, {-0.0002614}, {-0.0002901}, {-0.0003321}, {-0.000314}, {-0.0002844}, {-0.000207}, {-0.0001382}, {-7.14e-05}, {-5.42e-05}, {-2.24e-05}, {-6.24e-05}, {-0.0001052}, {-0.0001876}, {-0.0002659}, {-0.0003202}, {-0.0003181}, {-0.0002872}, {-0.0002199}, {-0.0001179}, {-1.28e-05}, {0.0001029}, {0.0001445}, {0.0001865}, {0.0001984}, {0.0002312}, {0.0001898}, {0.0001725}, {0.0001197}, {0.00015}, {0.0001316}, {0.0001237}, {5.17e-05}, {2.59e-05}, {-4.1e-05}, {-6.07e-05}, {-0.0001099}, {-0.0001228}, {-0.0001426}, {-9.55e-05}, {-4.03e-05}, {4.65e-05}, {0.0001022}, {0.0001649}, {0.0002133}, {0.0002568}, {0.0002522}, {0.0002353}, {0.0001903}, {0.0001448}, {8.03e-05}, {2.79e-05}, {-2.78e-05}, {-5.85e-05}, {-9.35e-05}, {-0.0001058}, {-9.88e-05}, {-8.87e-05}, {-5.65e-05}, {-1.5e-06}, {5.52e-05}, {0.000122}, {0.0002093}, {0.0002616}, {0.0003235}, {0.0003211}, {0.0002888}, {0.0002364}, {0.0001735}, {7.65e-05}, {1.37e-05}, {-6.94e-05}, {-7.76e-05}, {-6.2e-05}, {-4.2e-06}, {3.52e-05}, {6.16e-05}, {8.14e-05}, {0.0001239}, {0.0001019}, {6.27e-05}, {-2.9e-05}, {-5.03e-05}, {-6.33e-05}, {-6.11e-05}, {-7.88e-05}, {-5.63e-05}, {-3.56e-05}, {1.6e-05}, {5.1e-06}, {4.91e-05}, {4.62e-05}, {8.29e-05}, {9.83e-05}, {0.0001583}, {0.0002206}, {0.0002774}, {0.0002956}, {0.0003387}, {0.000361}, {0.0003591}, {0.0003127}, {0.0002408}, {0.0002029}, {0.0001356}, {8.49e-05}, {3.52e-05}, {7.17e-05}, {0.0001723}, {0.0003021}, {0.0004736}, {0.0007104}, {0.0009899}, {0.0013264}, {0.0016279}, {0.0018754}, {0.0021758}, {0.0024347}, {0.0026836}, {0.0028875}, {0.0030088}, {0.0031028}, {0.0031813}, {0.0031633}, {0.003101}, {0.0029931}, {0.0028582}, {0.0027226}, {0.0025859}, {0.002469}, {0.002374}, {0.0023122}, {0.0022578}, {0.0022076}, {0.0021697}, {0.0021249}, {0.0020622}, {0.0019939}, {0.0019135}, {0.0018093}, {0.0016511}, {0.001475}, {0.0012926}, {0.0010832}, {0.0008551}, {0.0006006}, {0.0003548}, {0.000171}, {-1.99e-05}, {-0.0001965}, {-0.0003345}, {-0.0004443}, {-0.000534}, {-0.0006027}, {-0.0006571}, {-0.0006724}, {-0.0006532}, {-0.0006444}, {-0.0006245}, {-0.0006039}, {-0.0005743}, {-0.0005506}, {-0.000534}, {-0.0005783}, {-0.0006025}, {-0.0006056}, {-0.0005872}, {-0.0005529}, {-0.0005604}, {-0.0005392}, {-0.0004912}, {-0.0004485}, {-0.0004572}, {-0.0004584}, {-0.0004934}, {-0.0004788}, {-0.0005078}, {-0.0005458}, {-0.0005759}, {-0.0006141}, {-0.0006533}, {-0.0006864}, {-0.0007317}, {-0.0007501}, {-0.0007516}, {-0.0007616}, {-0.0007108}, {-0.000687}, {-0.00066}, {-0.0006286}, {-0.0006156}, {-0.0005822}, {-0.0005495}, {-0.0005637}, {-0.0005295}, {-0.0004932}, {-0.0004715}, {-0.0004659}, {-0.0005013}, {-0.0005498}, {-0.0005722}, {-0.0006495}, {-0.0007173}, {-0.0007675}, {-0.000788}, {-0.0007743}, {-0.0007474}, {-0.0007003}, {-0.000664}, {-0.000644}, {-0.0006398}, {-0.000629}, {-0.0006231}, {-0.000607}, {-0.0006461}, {-0.0006375}, {-0.0005965}, {-0.0005587}, {-0.0005309}, {-0.0005198}, {-0.0005256}, {-0.0005049}, {-0.0004925}, {-0.0005231}, {-0.0005418}, {-0.0005534}, {-0.0005595}, {-0.0005352}, {-0.000515}, {-0.0005125}, {-0.0004906}, {-0.0004594}, {-0.0004696}, {-0.000506}, {-0.0005812}, {-0.0006411}, {-0.0006846}, {-0.0007461}, {-0.0008056}, {-0.000838}, {-0.000829}, {-0.0008258}, {-0.0008265}, {-0.0008352}, {-0.0008228}, {-0.0008348}, {-0.000824}, {-0.0008114}, {-0.0007749}};
        PCA p1 = new PCA(this.raw_signal, 1);
        p1.fit();

        double[][] output = p1.transform();
        for (int i=0; i<reduced_signal.length; i++) {
            Assertions.assertArrayEquals(reduced_signal[i], output[i], 0.001);
        }

        double[] t = UtilMethods.arange(0.0, (double)reduced_signal.length, 1.0);
        double[] one_dim = new double[reduced_signal.length];

        for (int i=0; i< reduced_signal.length; i++) {
            one_dim[i] = reduced_signal[i][0];
        }

        double[][] three_dim = UtilMethods.transpose(this.raw_signal);

        String title = "PCA for Dimensionality Reduction";
        String[] titles = {"X", "Y", "Z"};
        Plotting fig = new Plotting(600, 300, title, "Time", "Signal");
        fig.initialisePlot();
        for (int i=0; i<three_dim.length; i++) {
            fig.addSignal(titles[i], t, three_dim[i], false, "--");
        }
        fig.addSignal("PCA", t, one_dim, false, "-");

        String outputFileName = "test_outputs/pca.png";
        fig.saveAsPNG(outputFileName);
        boolean fileExists = new File("./"+outputFileName).exists();
        Assertions.assertTrue(fileExists);
    }
}
